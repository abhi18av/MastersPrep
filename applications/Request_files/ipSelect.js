
(function(){'use strict';inproces.directive('ipSelect',function($sce,$parse,$compile,ipApi){function link(scope,element,attrs,ngModel){element.addClass('ip-select');element.removeAttr('ip-select');element.removeAttr('data-ip-select');var template;if(attrs.selectfromschema){template='<md-autocomplete layout-fill '+' md-autoselect="false" '+' md-autofocus'+
(attrs.label?'    md-floating-label="'+attrs.label+'"':'')+' md-selected-item="selectedChoice" '+' md-delay="1000"'+' md-search-text="searchText" '+' md-items="choice in search(searchText)"'+' md-item-text="choice[selectfromdisplayfield]"'+' md-selected-item-change="change(choice)">'+'     <md-item-template md-highlight-text="searchText">'+
(element[0].childElementCount>0?element[0].innerHTML.trim():'<div class="resultaat-autocomplete">{{ choice[selectfromdisplayfield] }}</div>')+'     </md-item-template>'+'     <md-not-found>Geen gegevens gevonden</md-not-found>'+' </md-autocomplete>';scope.search=function(searchText){return ipApi.search({schema:attrs.selectfromschema,search:(attrs.selectfromquery||'{query}').replace(/\{query\}/,searchText)}).$promise;};scope.change=function(selectedChoice){ngModel.$setViewValue(selectedChoice&&selectedChoice[attrs.selectfromvaluefield]);scope.$root.$broadcast('select',selectedChoice,scope.$parent);};ngModel.$render=function(){if(ngModel.$modelValue){ipApi.read({schema:attrs.selectfromschema,sleutel:ngModel.$modelValue}).$promise.then(function(response){if(!scope.selectedChoice||!angular.equals(scope.selectedChoice,response)){scope.selectedChoice=response;}});}else{scope.selectedChoice=null;}};}else{var options=$parse(attrs.selectfromlist)(scope);template='<md-select ng-change="change()" ng-model="selectedValue">';angular.forEach(options,function(option){template+='<md-option ng-value="\''+option+'\'">'+option+'</md-option>';});template+='</md-select>';if(attrs.label){template='<md-input-container layout-fill>'+'<label>'+attrs.label+'</label>'+
template+'</md-input-container>';}
scope.change=function(){ngModel.$setViewValue(scope.selectedValue);scope.$root.$broadcast('select',scope.selectedValue,scope.$parent);};ngModel.$render=function(){scope.selectedValue=ngModel.$modelValue;};}
element.html(template);$compile(element.contents())(scope);}
return{require:'ngModel',replace:true,restrict:'A',scope:{label:'@label',ngModel:'=',selectfromdisplayfield:'@selectfromdisplayfield',selectfromvaluefield:'@selectfromvaluefield'},link:link};});})();