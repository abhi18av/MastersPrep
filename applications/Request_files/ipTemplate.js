'use strict';(function(){inproces.factory('ipTemplate',function($http,$q){return function(params){var componentschema=params.componentschema||(params.widget?'widget':'portaal');var componentsleutel=componentschema==='portaal'?params.portal:params.widget;var url='/api/'+componentschema+'/view/'+componentsleutel;var d=$q.defer();$http({method:'GET',url:url,params:params}).then(function(html){var parser=new window.DOMParser();var doc=parser.parseFromString(html.data,'text/html');var scripts=doc.querySelectorAll('script');var index=0;angular.forEach(scripts,function(script){try{eval(script.textContent);}catch(e){d.resolve('<h1>Oeps!! Fout bij het tonen van pagina '+
componentschema+' '+componentsleutel+'</h1>'+'<md-button ng-show="!showerror" ng-click="showerror=true">toon details</md-button>'+'<div ng-show="showerror">'+'<h3>'+e.name+': '+e.message+'</h3>'+'<h2>Script nr. '+(index+1)+'</h2><div ui-ace="{mode:\'javascript\'}" readonly style="height:300px">'+script.textContent+'</div><br/>'+'<h2>Stacktrace</h2><div ui-ace="{mode:\'text\'}" readonly style="height:100px">'+e.stack+'</div><br/>'+'<h2>HTML</h2><div ui-ace="{mode:\'html\'}" readonly style="height:300px">'+html.data.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')+'</div>'+'</div>');return;}
index++;},this);var body=doc.querySelector('body').innerHTML;var style=doc.querySelector('head').innerHTML;d.resolve(body+(style||''));},function(response){var data=response.data;var contenttype=response.headers('content-type');var format='html';if(contenttype==='text/json'){data=JSON.stringify(response.data||'',null,'\t');format='json';}
d.resolve('<div style="background-color:white;padding:10px">'+'<h2>Oeps!! Op de server ging iets fout bij het opvragen van '+componentschema+' '+componentsleutel+'. '+response.statusText+' ('+response.status+')</h2>'+'<md-button ng-show="!showerror" ng-click="showerror=true">toon details</md-button>'+'<div ng-show="showerror">'+'<h3>Request</h3><div ui-ace="{mode:\'json\'}" readonly style="height:200px">'+JSON.stringify(response.config,null,'\t')+'</div>'+'<h3>Response</h3><div ui-ace="{mode:\''+format+'\'}" readonly style="height:200px">'+data+'</div>'+'</div>'+'</div>');});return d.promise;};});})();